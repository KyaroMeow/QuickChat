<Page x:Class="QuickChatApp.Pages.ChatPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:QuickChatApp.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="ChatPage">

    <Grid x:Name="RootGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель со списком чатов -->
        <DockPanel Grid.Column="0">
            <Border DockPanel.Dock="Top" Background="{StaticResource BackgroundColor}" Padding="10,8">
                <DockPanel>
                    <Button x:Name="MenuButton" DockPanel.Dock="Left" Style="{StaticResource IconButtonStyle}" 
                            Width="30" Height="30">
                        <TextBlock Text="☰" FontSize="24" Foreground="{StaticResource TextSecondaryColor}"/>
                    </Button>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                        <TextBlock Text="QuickChat" Style="{StaticResource AppTitleStyle}" Padding="0" Margin="0"/>
                        <Image Source="/Assets/Images/icon.png" Width="32" Height="35" Margin="0" />
                    </StackPanel>
                </DockPanel>
            </Border>
            <!--меню со скруглением-->
            <Border Style="{StaticResource SidebarStyle}"
                    DockPanel.Dock="Top">
                <DockPanel Margin="10,10,4,10">
                    <DockPanel DockPanel.Dock="Top">
                        <Button DockPanel.Dock="Right" VerticalAlignment="Center" Style="{StaticResource AddChatButtonStyle}" Margin="5,0,0,0"></Button>
                            <Border Style="{StaticResource SearchContainerStyle}">
                                <DockPanel>
                                    <Image Source="/Assets/Images/search.png" Width="15" Height="15" Margin="5" />
                                        <TextBox Style="{StaticResource SearchBoxStyle}"
                                             Text="Поиск чатов"
                                             Margin="0,4"/>
                                </DockPanel>
                            </Border>
                    </DockPanel>
                    <ListBox x:Name="ChatsList" 
                             Style="{StaticResource ChatListStyle}"
                             ItemContainerStyle="{StaticResource ChatItemStyle}">

                        <!-- Примеры чатов -->
                        <ListBoxItem>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Style="{StaticResource SmallAvatarStyle}"/>
                                <StackPanel Margin="10,0" VerticalAlignment="Center">
                                    <TextBlock Text="Анна Петрова" Style="{StaticResource ContactNameStyle}"/>
                                    <TextBlock Text="Привет! Как дела?" Style="{StaticResource LastMessageStyle}"/>
                                </StackPanel>
                            </StackPanel>
                        </ListBoxItem>

                        <ListBoxItem>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Style="{StaticResource SmallAvatarStyle}"/>
                                <StackPanel Margin="10,0" VerticalAlignment="Center">
                                    <TextBlock Text="Михаил Козлов" Style="{StaticResource ContactNameStyle}"/>
                                    <TextBlock Text="Увидимся завтра" Style="{StaticResource LastMessageStyle}"/>
                                </StackPanel>
                            </StackPanel>
                        </ListBoxItem>

                        <ListBoxItem>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Style="{StaticResource SmallAvatarStyle}"/>
                                <StackPanel Margin="10,0" VerticalAlignment="Center">
                                    <TextBlock Text="Рабочая группа" Style="{StaticResource ContactNameStyle}"/>
                                    <TextBlock Text="Документы готовы" Style="{StaticResource LastMessageStyle}"/>
                                </StackPanel>
                            </StackPanel>
                        </ListBoxItem>
                    </ListBox>
                </DockPanel>
            </Border>
        </DockPanel>

        

        <!-- Правая панель с чатом -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="52"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="50"/>
            </Grid.RowDefinitions>

            <Border Grid.RowSpan="3" Style="{StaticResource ChatAreaStyle}">
                <Grid Background="Transparent">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="43"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="50"/>
                    </Grid.RowDefinitions>

                    <!-- Заголовок чата -->
                    <Border BorderBrush="{StaticResource PrimaryColor}" BorderThickness="0,0,0,1">
                        <DockPanel Grid.Row="0" Margin="4,2">
                            <Ellipse Style="{StaticResource AvatarStyle}" DockPanel.Dock="Left"/>
                            <StackPanel DockPanel.Dock="Left" Margin="5,0" VerticalAlignment="Center" >
                                <TextBlock Text="Анна Петрова" Style="{StaticResource ChatTitleStyle}"/>
                                <TextBlock Text="в сети" Style="{StaticResource LastMessageStyle}"/>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <!-- Область сообщений -->
                    <ScrollViewer Grid.Row="1" 
                                  Style="{StaticResource MessagesScrollViewerStyle}"
                                  x:Name="MessagesScrollViewer">
                        <StackPanel x:Name="MessagesPanel" Margin="2">

                            <!-- Примеры сообщений -->
                            <!-- Входящее сообщение -->
                            <Border Style="{StaticResource IncomingMessageStyle}">
                                <StackPanel>
                                    <TextBlock Text="Привет! Как дела? Давно не виделись!" 
                                               Style="{StaticResource MessageTextStyle}"/>
                                    <TextBlock Text="14:32" Style="{StaticResource MessageTimeStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Исходящее сообщение -->
                            <Border Style="{StaticResource OutgoingMessageStyle}">
                                <StackPanel>
                                    <TextBlock Text="Привет! Все отлично, спасибо! А у тебя как?" 
                                               Style="{StaticResource OutgoingMessageTextStyle}"/>
                                    <TextBlock Text="14:35" Style="{StaticResource OutgoingMessageTimeStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Входящее сообщение -->
                            <Border Style="{StaticResource IncomingMessageStyle}">
                                <StackPanel>
                                    <TextBlock Text="Тоже все хорошо! Может встретимся на выходных?" 
                                               Style="{StaticResource MessageTextStyle}"/>
                                    <TextBlock Text="14:40" Style="{StaticResource MessageTimeStyle}"/>
                                </StackPanel>
                            </Border>

                            <!-- Исходящее сообщение -->
                            <Border Style="{StaticResource OutgoingMessageStyle}">
                                <StackPanel>
                                    <TextBlock Text="Отличная идея! Давай в субботу встретимся в парке в 2 часа?" 
                                               Style="{StaticResource OutgoingMessageTextStyle}"/>
                                    <TextBlock Text="14:42" Style="{StaticResource OutgoingMessageTimeStyle}"/>
                                </StackPanel>
                            </Border>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- Поле ввода сообщения -->
                    <Border Grid.Row="2" Background="Transparent" Padding="5" BorderBrush="{StaticResource PrimaryColor}" BorderThickness="0,1,0,0">
                        <DockPanel>
                            <Button DockPanel.Dock="Right" 
                                    Style="{StaticResource SendButtonStyle}" 
                                    Margin="5,0,0,0"/>
                            <TextBox x:Name="MessageInput" 
                                     Style="{StaticResource MessageInputStyle}"
                                     Text="Введите сообщение..."/>
                        </DockPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        <Popup x:Name="SidebarPopup"
           Placement="Relative"
           AllowsTransparency="True"
           StaysOpen="False"
           PopupAnimation="Slide"
           HorizontalOffset="0"
           VerticalOffset="0"
           IsOpen="True">

            <!-- Затемнение и сайдбар -->
            <Grid Width="{Binding ActualWidth, ElementName=RootGrid}"
              Height="{Binding ActualHeight, ElementName=RootGrid}"
              Background="#80000000">
                <!-- Полупрозрачный фон -->

                <Border Width="240"
                    Background="White"
                    HorizontalAlignment="Left"
                    Padding="20">
                    <StackPanel>
                        <Ellipse Width="50" Height="50" Fill="#5F9EA0"/>
                        <TextBlock Text="UserName" FontSize="16" FontWeight="Bold" Margin="0,10"/>
                        <Button Content="Настройки профиля" Margin="0,5"/>
                        <Button Content="Список контактов" Margin="0,5"/>
                        <Button Content="Выйти из аккаунта" Margin="0,40,0,0" Background="#e69b75" Foreground="White"/>
                        <TextBlock Text="Версия 0.2025.00" FontSize="10" Foreground="Gray" Margin="0,20,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Popup>

        <!-- Triggers: открыть Popup по нажатию кнопки -->
        <Grid.Triggers>
            <EventTrigger SourceName="MenuButton" RoutedEvent="Button.Click">
                <BeginStoryboard>
                    <Storyboard>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SidebarPopup"
                                                   Storyboard.TargetProperty="IsOpen">
                            <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="True"/>
                        </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Grid.Triggers>
    </Grid>
</Page>
